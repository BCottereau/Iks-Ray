<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Test de D3</title>
	<script src="d3.v3.min.js"type="text/javascript"></script>
	<script type="text/javascript">
		function draw(dataset) {
			
			 // LA MAP, un tableau 2D map[x][y]  
			 //  1 = mur, 0 = sol etc.
			dataset = [
				[1,8,1,1,1,1,1,1],
				[1,0,1,0,0,0,0,9],
				[1,0,1,0,1,1,1,1],
				[1,0,0,0,0,0,0,1],
				[1,1,1,1,1,1,1,1]
			];
		
			var nbrX = 8;
			var nbrY = 5;
			var taille = 60;
			var larg = taille*nbrX;
			var haut = taille*nbrY;
			
			var svg = d3.select("body")
				.append("svg")
				.attr("width", 1580)
				.attr("height", 850);

			var map = [];
			
			// Une boucle 2D  i=x  j=y
			for(var i = 0 ; i < nbrX ; i++)
			{
				map[i] = [];
				for(var j = 0 ; j < nbrY ; j++)
				{
					map[i][j] = svg.append("svg:image")
						.attr("x", i*taille)
						.attr("y", j*taille)
						.attr("width", taille)
						.attr("height", taille)
						.attr("xlink:href", function(){
							if(dataset[j][i] == 1){return "b.png";}
							else if(dataset[j][i] == 8){return "c.png";}
							else if(dataset[j][i] == 9){return "d.png";}
							else{return "a.png";}
						});
				}
			}
			
			
			
			
			
			
			
			
			
			
			
			/* ----------------- Transitions ---------------- */
			
			bidule = [1,1,1,3,3,0,0,3,3,3,3]; 
			
			var posX = 1, posY = 0;
			
			for(i=0; i <= bidule.length ; i++)
			{
				map[posX][posY].transition()
					.delay(  (i*200)  + 1500  )
					.duration(200)
					.attr("xlink:href", "e.png");
					
				if(bidule[i] == 0){posY--;}
				else if(bidule[i] == 1){posY++;}
				else if(bidule[i] == 2){posX--;}
				else if(bidule[i] == 3){posX++;}
			}
			
			
			for(var i = 0 ; i < nbrX ; i++)
			{
				for(var j = 0 ; j < nbrY ; j++)
				{
					map[i][j].transition()
					.delay( 4000 +   ((j+i)*100 )  )
					.duration(1000)
					.attr("x", i* (taille*1.1))
					.attr("y", j * (taille*1.1));
				}
			}
			
			for(var i = 0 ; i < nbrX ; i++)
			{
				for(var j = 0 ; j < nbrY ; j++)
				{
					map[i][j].transition()
					.delay( 6000 + ( (j+i)*100 )  )
					.duration(1500)
					.attr("x", 400)
					.attr("y", 400);
				}
			}
			
			for(var i = 0 ; i < nbrX ; i++)
			{
				for(var j = 0 ; j < nbrY ; j++)
				{
					map[i][j].transition()
					.delay( 8000 + ( (j+i)*100 )  )
					.duration(1500)
					.attr("x", j*taille)
					.attr("y", i*taille);
				}
			}
			
			for(var i = 0 ; i < nbrX ; i++)
			{
				for(var j = 0 ; j < nbrY ; j++)
				{
					map[i][j].transition()
					.delay( 10000 + ( (j+i)*100 )  )
					.duration(1500)
					.attr("x", i*taille)
					.attr("y", j*taille)
					.attr("xlink:href", "e.png");
				}
			}
			
			for(var i = 0 ; i < nbrX ; i++)
			{
				for(var j = 0 ; j < nbrY ; j++)
				{
					map[i][j].transition()
					.delay( 12000 + ( (j+i)*100 )  )
					.duration(1500)
					.attr("x", i*taille)
					.attr("y", j*taille)
					.attr("xlink:href", function(){
							if(dataset[j][i] == 1){return "b.png";}
							else if(dataset[j][i] == 8){return "c.png";}
							else if(dataset[j][i] == 9){return "d.png";}
							else{return "a.png";}
						});
				}
			}
			
			for(var i = 0 ; i < nbrX ; i++)
			{
				for(var j = 0 ; j < nbrY ; j++)
				{
					map[i][j].transition()
					.delay( 14000 + ( (j+i)*50 )  )
					.duration(1000)
					.attr("x", (i * taille) + (taille/2))
					.attr("width", 0);
				}
			}
			for(var i = 0 ; i < nbrX ; i++)
			{
				for(var j = 0 ; j < nbrY ; j++)
				{
					map[i][j].transition()
					.delay( 14600 + ( (j+i)*50 )  )
					.duration(1000)
					.attr("x", (i * taille) )
					.attr("width", taille);
				}
			}


			
			

		}
	</script>
</head>
<body>
	<script type="text/javascript">
		d3.json("map4.json", draw);
	</script>
</body>
</html>